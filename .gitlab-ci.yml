image: node:latest

stages:
 - build
 - test
  
install_dependencies:
 stage: build
 script:
  - npm install
 artifacts:
  paths:
   - tig_client/node_modules/
   - node_modules/
   
testing:
 stage: test
 services:
  - mongo:latest

 variables:
  MONGO_DATABASE: test

  Host: cluster0-e8bno.gcp.mongodb.net
  Database: test
  
 script:
  - chmod 0777 ./node_modules/.bin/mocha
  - chmod 0777 ./node_modules/.bin/start-test
  - chmod 0777 ./node_modules/.bin/pm2
  - npm run test
 artifacts:
  paths:
   - tig_client/